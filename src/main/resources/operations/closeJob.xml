<template xmlns="http://ws.apache.org/ns/synapse" name="closeJob">
    <parameter name="jobId" description="Job ID"/>
    <sequence>
        <property name="jobId" expression="$func:jobId" />
        <class name="org.wso2.carbon.esb.connector.operations.CloseJob" />
        <property name="uri.var.url" expression="get-property('closeJobUrl')" />
        <property name="uri.var.accessToken" expression="get-property('accessToken')" />
        <header name="Authorization"
                expression="fn:concat('Bearer  ', $ctx:uri.var.accessToken )"
                scope="transport"/>
        <payloadFactory media-type="json">
            <format>
                <![CDATA[{ "state" : "UploadComplete" }]]>
            </format>
            <args/>
        </payloadFactory>
        <call>
            <endpoint>
                <http method="patch" uri-template="{uri.var.url}">
                    <timeout>
                        <duration>60000</duration>
                        <responseAction>fault</responseAction>
                    </timeout>
                    <suspendOnFailure>
                        <initialDuration>2000</initialDuration>
                        <progressionFactor>1.0</progressionFactor>
                        <maximumDuration>3000</maximumDuration>
                    </suspendOnFailure>
                </http>
            </endpoint>
        </call>

    </sequence>
</template>
